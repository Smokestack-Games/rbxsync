[{"className":"ModuleScript","name":"Init","properties":{"Capabilities":{"type":"Enum","value":{"enumType":"SecurityCapabilities","value":""}},"LinkedSource":{"type":"Enum","value":{"enumType":"ContentId","value":""}},"Source":{"type":"ProtectedString","value":"local ServerStorage = game:GetService(\"ServerStorage\")\nlocal ReplicatedStorage = game:GetService(\"ReplicatedStorage\")\nlocal Debris = game:GetService(\"Debris\")\n\nlocal Init = {}\nInit.__index = Init\n\n\n\nfunction Init:LoadMap(MapName)\n\t-- Find the map\n\tlocal map = ServerStorage.Maps:FindFirstChild(MapName)\n\tif not map then\n\t\twarn(\"Failed to find map with name: \" .. MapName)\n\t\treturn self\n\tend\n\n\tlocal mapData = require(map:FindFirstChild(\"MapData\"))\n\t\n\t-- Asynchronous part creation\n\tlocal co = coroutine.create(function()\n\t\tlocal partData = require(ReplicatedStorage.PartData)\n\t\tpartData.CreatePartData(map.voxels, mapData.width * mapData.height)\n\tend)\n\n\t-- Start the coroutine\n\tcoroutine.resume(co)\n\n\t\n\t-- Cache references for quicker access\n\tlocal replicatedData = ReplicatedStorage.Data\n\n\t-- Set the map data in ReplicatedStorage.Data\n\treplicatedData.MapName.Value = MapName\n\treplicatedData.MapLandSize.Value = self:CalculateSizeFromPixelData(mapData.pixelData, 2)\n\treplicatedData.MapWaterSize.Value = self:CalculateSizeFromPixelData(mapData.pixelData, 1)\n\treplicatedData.MapTotalSize.Value = mapData.height * mapData.width\n\n\t-- Remove all other maps in ServerStorage.Maps\n\tfor _, otherMap in ipairs(ServerStorage.Maps:GetChildren()) do\n\t\tif otherMap ~= map then\n\t\t\tDebris:AddItem(otherMap, 0)  -- Destroy immediately\n\t\tend\n\tend\n\n\t-- Parent voxel folder earlier for faster client loading\n\tmap.voxels.Parent = game.Workspace\n\n\t-- Move map data to the correct locations\n\tmap.MapData.Parent = ReplicatedStorage\n\n\t\n\t-- Wait until the coroutine completes\n\twhile coroutine.status(co) ~= \"dead\" do\n\t\ttask.wait()  -- You can adjust this wait time as needed\n\tend\n\n\treturn self\nend\n\n\n-- Helper function to calculate size based on pixel data\nfunction Init:CalculateSizeFromPixelData(pixelData, type)\n\tlocal count = 0\n\tfor _, value in pairs(pixelData) do\n\t\tif value == type then\n\t\t\tcount = count + 1\n\t\tend\n\tend\n\treturn count\nend\n\nfunction Init:LoadGameMode(GamemodeName)\n\tReplicatedStorage.Data.Gamemode.Value = GamemodeName\n\treturn self\nend\n\nreturn Init\n"}},"referenceId":"00000049-5dc3-b012-3cbd-000052b796a7","source":"local ServerStorage = game:GetService(\"ServerStorage\")\nlocal ReplicatedStorage = game:GetService(\"ReplicatedStorage\")\nlocal Debris = game:GetService(\"Debris\")\n\nlocal Init = {}\nInit.__index = Init\n\n\n\nfunction Init:LoadMap(MapName)\n\t-- Find the map\n\tlocal map = ServerStorage.Maps:FindFirstChild(MapName)\n\tif not map then\n\t\twarn(\"Failed to find map with name: \" .. MapName)\n\t\treturn self\n\tend\n\n\tlocal mapData = require(map:FindFirstChild(\"MapData\"))\n\t\n\t-- Asynchronous part creation\n\tlocal co = coroutine.create(function()\n\t\tlocal partData = require(ReplicatedStorage.PartData)\n\t\tpartData.CreatePartData(map.voxels, mapData.width * mapData.height)\n\tend)\n\n\t-- Start the coroutine\n\tcoroutine.resume(co)\n\n\t\n\t-- Cache references for quicker access\n\tlocal replicatedData = ReplicatedStorage.Data\n\n\t-- Set the map data in ReplicatedStorage.Data\n\treplicatedData.MapName.Value = MapName\n\treplicatedData.MapLandSize.Value = self:CalculateSizeFromPixelData(mapData.pixelData, 2)\n\treplicatedData.MapWaterSize.Value = self:CalculateSizeFromPixelData(mapData.pixelData, 1)\n\treplicatedData.MapTotalSize.Value = mapData.height * mapData.width\n\n\t-- Remove all other maps in ServerStorage.Maps\n\tfor _, otherMap in ipairs(ServerStorage.Maps:GetChildren()) do\n\t\tif otherMap ~= map then\n\t\t\tDebris:AddItem(otherMap, 0)  -- Destroy immediately\n\t\tend\n\tend\n\n\t-- Parent voxel folder earlier for faster client loading\n\tmap.voxels.Parent = game.Workspace\n\n\t-- Move map data to the correct locations\n\tmap.MapData.Parent = ReplicatedStorage\n\n\t\n\t-- Wait until the coroutine completes\n\twhile coroutine.status(co) ~= \"dead\" do\n\t\ttask.wait()  -- You can adjust this wait time as needed\n\tend\n\n\treturn self\nend\n\n\n-- Helper function to calculate size based on pixel data\nfunction Init:CalculateSizeFromPixelData(pixelData, type)\n\tlocal count = 0\n\tfor _, value in pairs(pixelData) do\n\t\tif value == type then\n\t\t\tcount = count + 1\n\t\tend\n\tend\n\treturn count\nend\n\nfunction Init:LoadGameMode(GamemodeName)\n\tReplicatedStorage.Data.Gamemode.Value = GamemodeName\n\treturn self\nend\n\nreturn Init\n"}]